<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<title>ShmoopsiePoo - Yael & Amit</title>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
<style>
@import url('https://fonts.googleapis.com/css2?family=Rubik:wght@400;500;600;700;800&display=swap');

:root {
  --bg-body:#0f172a;--bg-card:#1e293b;--bg-input:rgba(255,255,255,0.05);--border-color:rgba(255,255,255,0.1);
  --text-main:#f1f5f9;--text-sub:#94a3b8;--text-muted:#64748b;--accent:#14b8a6;
  --shadow:0 10px 25px rgba(0,0,0,0.5);--modal-bg:rgba(15,23,42,0.9);--nav-bg:rgba(15,23,42,0.95);
}
[data-theme="light"]{
  --bg-body:#f1f5f9;--bg-card:#ffffff;--bg-input:#e2e8f0;--border-color:#cbd5e1;
  --text-main:#0f172a;--text-sub:#475569;--text-muted:#94a3b8;--accent:#0d9488;
  --shadow:0 4px 15px rgba(0,0,0,0.1);--modal-bg:rgba(241,245,249,0.9);--nav-bg:rgba(255,255,255,0.95);
}

*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
body{background:var(--bg-body);color:var(--text-main);font-family:'Rubik',system-ui,sans-serif;direction:rtl;min-height:100vh;overflow-x:hidden;padding-bottom:90px;transition:background 0.3s,color 0.3s}

/* ×©×›×‘×ª ×”××“×‘×§×” ×”×× ×¦×—×ª */
#stickerOverlay {
  position: fixed; top: 0; left: 0; width: 100%; height: 100%;
  display: none; align-items: center; justify-content: center;
  z-index: 200000; pointer-events: none;
}
.sticker-img {
  width: 250px; height: 250px;
  animation: stickerPop 1.5s ease-out forwards;
}
@keyframes stickerPop {
  0% { transform: scale(0) rotate(-20deg); opacity: 0; }
  20% { transform: scale(1.2) rotate(10deg); opacity: 1; }
  80% { transform: scale(1.1) rotate(0deg); opacity: 1; }
  100% { transform: scale(0) rotate(20deg); opacity: 0; }
}

#bioLockScreen{position:fixed;top:0;left:0;right:0;bottom:0;background:var(--bg-body);z-index:100001;display:none;flex-direction:column;align-items:center;justify-content:center;padding:20px;backdrop-filter:blur(10px)}
.bio-box{text-align:center;animation:fadeIn 0.5s ease}
.bio-icon{font-size:60px;margin-bottom:20px;cursor:pointer}

#loginScreen{position:fixed;top:0;left:0;right:0;bottom:0;background:var(--bg-body);z-index:100000;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:20px}
.l-box{background:var(--bg-card);padding:40px 30px;border-radius:24px;width:100%;max-width:340px;text-align:center;box-shadow:var(--shadow);border:1px solid var(--border-color)}
.l-ttl{font-size:28px;font-weight:800;margin-bottom:8px;background:linear-gradient(135deg,#14b8a6,#f97316);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.l-sub{font-size:14px;color:var(--text-sub);margin-bottom:24px}
.l-btn{width:100%;padding:14px;background:white;color:#333;border:none;border-radius:10px;font-weight:700;font-size:15px;font-family:inherit;cursor:pointer;margin-top:6px;display:flex;align-items:center;justify-content:center;gap:10px;box-shadow:0 2px 4px rgba(0,0,0,0.1);transition:background 0.2s}
.l-err{color:#f87171;font-size:12px;margin-bottom:12px;display:none;line-height:1.4}

.hdr{background:linear-gradient(135deg,#134e4a,#0d9488,#134e4a);padding:16px;padding-top:calc(16px + env(safe-area-inset-top));position:sticky;top:0;z-index:50;box-shadow:0 2px 12px rgba(13,148,136,0.3)}
.hdr-r{display:flex;align-items:center;justify-content:space-between}
.lg{font-size:18px;font-weight:800;color:#fff}
.lg-s{font-size:10px;color:rgba(255,255,255,0.8)}
.ref-btn{background:rgba(255,255,255,0.15);border:none;color:#fff;border-radius:8px;padding:4px 10px;font-size:14px;font-family:inherit;cursor:pointer;margin-right:5px}

.ct{padding:12px}
.kg{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:12px}
.kp{background:var(--bg-input);border-radius:12px;padding:12px 14px;flex:1 1 45%;min-width:135px;border:1px solid var(--border-color)}
.kl{font-size:10px;color:var(--text-sub);margin-bottom:2px;font-weight:500}
.kv{font-size:20px;font-weight:700;letter-spacing:-0.02em}
.tl{color:var(--accent)}.or{color:#f97316}.bl{color:#3b82f6}.rd{color:#f87171}.gn{color:#34d399}

.cd{background:var(--bg-card);border-radius:12px;padding:14px;margin-bottom:12px;border:1px solid var(--border-color)}
.ttt{font-size:12px;font-weight:600;margin-bottom:10px;color:var(--text-main)}

.fab{position:fixed;bottom:90px;left:20px;width:56px;height:56px;background:var(--accent);border-radius:50%;display:flex;align-items:center;justify-content:center;color:white;font-size:30px;box-shadow:0 4px 12px rgba(20,184,166,0.4);z-index:1000;border:none;cursor:pointer;transition:transform 0.2s}
.fab.exp{background:#f97316;box-shadow:0 4px 12px rgba(249,115,22,0.4)}

.modal{position:fixed;top:0;left:0;right:0;bottom:0;background:var(--modal-bg);z-index:2000;display:none;align-items:center;justify-content:center;padding:20px;backdrop-filter:blur(5px)}
.modal.open{display:flex}
.m-box{background:var(--bg-card);width:100%;max-width:400px;border-radius:16px;padding:20px;border:1px solid var(--border-color);box-shadow:var(--shadow)}
.m-tl{font-size:18px;font-weight:700;margin-bottom:16px;color:var(--text-main);text-align:center}
.inp{width:100%;padding:10px;background:var(--bg-input);border:1px solid var(--border-color);border-radius:8px;color:var(--text-main);font-family:inherit;font-size:14px;outline:none;margin-bottom:12px}

.nav{position:fixed;bottom:0;left:0;right:0;background:var(--nav-bg);backdrop-filter:blur(20px);border-top:1px solid var(--border-color);display:flex;justify-content:space-around;padding:8px 0;padding-bottom:calc(8px + env(safe-area-inset-bottom));z-index:9999}
.nb{background:none;border:none;display:flex;flex-direction:column;align-items:center;cursor:pointer;padding:3px 8px}
.nb .ic{font-size:18px}.nb .lb{font-size:8px;font-weight:500}
.nb.on{color:var(--accent)}.nb.off{color:var(--text-muted)}

.pg{display:none}.pg.show{display:block}
.bio-setup-btn{width:100%;background:var(--bg-input);border:1px solid var(--border-color);color:var(--text-main);padding:12px;border-radius:10px;font-family:inherit;font-size:13px;font-weight:600;cursor:pointer;margin-top:10px;display:flex;align-items:center;justify-content:center;gap:8px}

@keyframes fadeIn { from {opacity:0;transform:scale(0.9)} to {opacity:1;transform:scale(1)} }
</style>
</head>
<body>

<div id="stickerOverlay">
  <img src="https://i.ibb.co/Xf8z1V4/shmoopsie-sticker.png" class="sticker-img" id="successSticker">
</div>

<div id="bioLockScreen">
  <div class="bio-box">
    <div class="bio-icon" onclick="unlockBio()">ğŸ‘¤</div>
    <div class="l-ttl">ShmoopsiePoo × ×¢×•×œ</div>
    <div class="l-sub">×”×©×ª××© ×‘×–×™×”×•×™ ×¤× ×™× ××• ×˜×‘×™×¢×ª ××¦×‘×¢</div>
    <button class="l-btn" onclick="unlockBio()" style="margin-top:20px; padding:10px 30px; background:var(--accent); color:white; width:auto;">×¤×ª×— × ×¢×™×œ×”</button>
  </div>
</div>

<div id="loginScreen">
  <div class="l-box">
    <div class="l-ttl">ğŸ’° ShmoopsiePoo</div>
    <div class="l-sub">Yael & Amit</div>
    <div id="loginErr" class="l-err"></div>
    <button class="l-btn" onclick="doGoogleLogin()">
      <svg width="18" height="18" viewBox="0 0 24 24"><path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285F4"/><path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/><path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"/><path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/></svg>
      ×”×ª×—×‘×¨ ×¢× ×’×•×’×œ
    </button>
  </div>
</div>

<div id="mainApp" style="display:none">
  <div class="hdr">
    <div class="hdr-r">
      <div><div class="lg">ğŸ’° ShmoopsiePoo</div><div class="lg-s">Yael & Amit</div></div>
      <div style="display:flex;align-items:center;gap:4px">
        <button class="ref-btn" onclick="toggleTheme()" id="themeBtn">â˜€ï¸</button>
        <button class="ref-btn" onclick="firebase.auth().signOut()">ğŸšª</button>
      </div>
    </div>
  </div>

  <div class="ct">
    <div id="pgS" class="pg show">
      <div class="kg" id="kpis"></div>
      <div id="sBox" class="sbox cd" style="text-align:center; padding:20px; font-weight:700;">×˜×•×¢×Ÿ × ×ª×•× ×™×...</div>
      <div class="upd" id="updTime"></div>
    </div>

    <div id="pgT" class="pg">
      <div class="cd">
        <div class="ttt">ğŸ”’ ××‘×˜×—×” ×‘×™×•××˜×¨×™×ª</div>
        <p style="font-size:12px; color:var(--text-sub); margin-bottom:10px;">×›××©×¨ ××•×¤×¢×œ, × ×‘×§×© ×–×™×”×•×™ ×¤× ×™× ×‘×›×œ ×¤×ª×™×—×”.</p>
        <button id="bioSetupBtn" class="bio-setup-btn" onclick="setupBio()">
          <span id="bioBtnIcon">ğŸ”’</span> <span id="bioBtnText">×”×¤×¢×œ × ×¢×™×œ×” ×‘×™×•××˜×¨×™×ª</span>
        </button>
      </div>
    </div>
  </div>

  <button class="fab" onclick="openModal('income')">+</button>
  <button class="fab exp" style="left: 90px;" onclick="openModal('expense')">ğŸ’¸</button>

  <div class="nav">
    <button class="nb on" id="n0" onclick="go('S')"><span class="ic">ğŸ“Š</span><span class="lb">×¨××©×™</span></button>
    <button class="nb off" id="n1" onclick="go('T')"><span class="ic">âš™ï¸</span><span class="lb">×”×’×“×¨×•×ª</span></button>
  </div>
</div>

<div class="modal" id="addModal">
  <div class="m-box">
    <div class="m-tl" id="modalTitle">×”×•×¡×¤×ª ×¤×¢×•×œ×”</div>
    <input type="number" class="inp" id="nAmt" placeholder="×¡×›×•×" inputmode="numeric">
    <input type="text" class="inp" id="nDesc" placeholder="×ª×™××•×¨">
    <button class="l-btn" style="background:var(--accent); color:white; width:100%;" onclick="saveItem()">×©××•×¨</button>
    <button onclick="closeModal()" style="width:100%; background:none; border:none; color:var(--text-sub); margin-top:15px; cursor:pointer;">×‘×™×˜×•×œ</button>
  </div>
</div>

<script>
firebase.initializeApp({
  apiKey:"AIzaSyDX0XDsaB5_JEDH7chBGMVyeUeqPnpwVlE",
  authDomain:"shmoopsiepoo1202.firebaseapp.com",
  databaseURL:"https://shmoopsiepoo1202-default-rtdb.europe-west1.firebasedatabase.app",
  projectId:"shmoopsiepoo1202",
  storageBucket:"shmoopsiepoo1202.firebasestorage.app",
  messagingSenderId:"589285900622",
  appId:"1:589285900622:web:1ac7d9b5181266f20b1e1f"
});
const db=firebase.database(),dbRef=db.ref('shmoopsiepoo');

const ALLOWED_EMAILS = {
  'goreshnikamit@gmail.com': 'Amit',
  'yaelzviy@gmail.com': 'Yael' // ×©× ×” ×œ××™×™×œ ×”×××™×ª×™ ×©×œ×”!
};

let currentUser='', curType='income', isBioLocked = false;
const bioKeyName = 'shmoopsie_bio_enabled';

// --- ×¡×˜×™×§×¨ ×•×× ×™××¦×™×” ---
function showSticker() {
  const overlay = document.getElementById('stickerOverlay');
  overlay.style.display = 'flex';
  setTimeout(() => { overlay.style.display = 'none'; }, 1500);
}

// --- × ×™×”×•×œ ×‘×™×•××˜×¨×™ ---
async function unlockBio() {
  if (!window.PublicKeyCredential) return;
  try {
    const challenge = new Uint8Array(32); window.crypto.getRandomValues(challenge);
    await navigator.credentials.get({publicKey: {challenge, timeout: 60000, userVerification: "required", allowCredentials: []}});
    document.getElementById('bioLockScreen').style.display = 'none';
    isBioLocked = false;
  } catch (e) { console.error("Bio failed", e); }
}

function setupBio() {
  if (localStorage.getItem(bioKeyName)) { localStorage.removeItem(bioKeyName); alert("×‘×•×˜×œ"); }
  else { localStorage.setItem(bioKeyName, 'true'); alert("×”×•×¤×¢×œ! ××”×¤×¢× ×”×‘××” × ×‘×§×© ×–×™×”×•×™ ×¤× ×™×."); }
  updateBioBtn();
}

function updateBioBtn() {
  const isEnabled = localStorage.getItem(bioKeyName);
  document.getElementById('bioBtnText').textContent = isEnabled ? "×‘×˜×œ × ×¢×™×œ×” ×‘×™×•××˜×¨×™×ª" : "×”×¤×¢×œ × ×¢×™×œ×” ×‘×™×•××˜×¨×™×ª";
  document.getElementById('bioBtnIcon').textContent = isEnabled ? "ğŸ”“" : "ğŸ”’";
}

// --- ××™××•×ª ×•×’×•×’×œ ---
firebase.auth().onAuthStateChanged(user => {
  if (user && ALLOWED_EMAILS[user.email.toLowerCase()]) {
    currentUser = ALLOWED_EMAILS[user.email.toLowerCase()];
    document.getElementById('loginScreen').style.display = 'none';
    document.getElementById('mainApp').style.display = 'block';
    if (localStorage.getItem(bioKeyName)) {
      document.getElementById('bioLockScreen').style.display = 'flex';
      isBioLocked = true; unlockBio();
    }
    updateBioBtn(); startListening();
  } else {
    document.getElementById('loginScreen').style.display = 'flex';
    document.getElementById('mainApp').style.display = 'none';
  }
});

function doGoogleLogin() {
  const provider = new firebase.auth.GoogleAuthProvider();
  firebase.auth().signInWithPopup(provider).catch(() => firebase.auth().signInWithRedirect(provider));
}

// --- ×¤×¢×•×œ×•×ª ---
function openModal(type) { 
  curType = type; 
  document.getElementById('modalTitle').textContent = type === 'income' ? '×”×•×¡×¤×ª ×”×›× ×¡×”' : '×”×•×¡×¤×ª ×”×•×¦××”';
  document.getElementById('addModal').classList.add('open'); 
}
function closeModal() { document.getElementById('addModal').classList.remove('open'); }

function saveItem() {
  const a = document.getElementById('nAmt').value;
  const d = document.getElementById('nDesc').value;
  if(!a || !d) return alert("××œ× ×¤×¨×˜×™×");

  dbRef.child(curType).push({
    a: parseFloat(a), desc: d, date: new Date().toISOString(), by: currentUser
  });

  closeModal();
  document.getElementById('nAmt').value = ''; document.getElementById('nDesc').value = '';

  // ×”××“×‘×§×” ××•×¤×™×¢×” ×¨×§ ×‘×”×•×¦××”!
  if (curType === 'expense') {
    showSticker();
  } else {
    if(typeof confetti==='function') confetti({particleCount: 150, spread: 70, origin: {y: 0.6}});
  }
}

function startListening() {
  dbRef.on('value', snap => {
    const v = snap.val() || {};
    const ti = Object.values(v.income || {}).reduce((s,r)=>s+r.a, 0);
    const te = Object.values(v.expense || {}).reduce((s,r)=>s+r.a, 0);
    document.getElementById('sBox').innerHTML = `×¡×”"×› ×”×›× ×¡×•×ª: â‚ª${ti.toLocaleString()} <br> ×¡×”"×› ×”×•×¦××•×ª: â‚ª${te.toLocaleString()}`;
    document.getElementById('updTime').textContent = '×¢×•×“×›×Ÿ ×œ××—×¨×•× ×”: ' + new Date().toLocaleTimeString();
  });
}

function go(p){
  document.getElementById('pgS').className = 'pg' + (p==='S'?' show':'');
  document.getElementById('pgT').className = 'pg' + (p==='T'?' show':'');
  document.getElementById('n0').className = 'nb' + (p==='S'?' on':' off');
  document.getElementById('n1').className = 'nb' + (p==='T'?' on':' off');
}

function toggleTheme(){
  document.body.getAttribute('data-theme')==='light' ? document.body.removeAttribute('data-theme') : document.body.setAttribute('data-theme','light');
}
</script>
</body>
</html>
